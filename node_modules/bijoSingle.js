var toDoubleDigits = function(num) {
  num += "";
  if (num.length === 1) {
    num = "0" + num;
  }
  return num;
};

exports.bijoSingle = function() {
  var client = require('cheerio-httpcli');
  var redis = require('redis').createClient();

  var link_org = 'http://www.bijogoyomi.com/bijo3/index.php/';
  var datTemp = new Date();
  url = link_org + String(datTemp.getFullYear()) +
                  '/' + String(toDoubleDigits(datTemp.getMonth()+1)) +
                  '/' + String(toDoubleDigits(datTemp.getDate()-4));

  client.fetch(url, {}, function (err, $, res) {

    imgUrl = $('div[class=panel-wrapper]').find('img').attr('src');
    name = $('td[class=prof]').find('ul li:nth-child(1)').children('strong').text();
    age = $('td[class=prof]').find('ul li:nth-child(2)').children('strong').text();
    height = $('td[class=prof]').find('ul li:nth-child(6)').children('strong').text();

    if (imgUrl != null) {
      var bijObj = {
        "bj_name" : name,
        "bj_age" : age,
        "bj_height" : height,
        "bj_img": 'http://www.bijogoyomi.com' + imgUrl
      };

      // set to Redis
      redis.set('bijo_' + imgUrl.slice(-25, -17), JSON.stringify(bijObj), function(){redis.quit();});
    } else {
      redis.quit();
    }

  });
};